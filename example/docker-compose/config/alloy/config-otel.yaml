# OpenTelemetry Collector configuration
#
# Receives OTLP traffic over gRPC on the default port:
# - gRPC: 4317
# and exports traces to Tempo over OTLP/gRPC.

extensions:
  alloyflow:
    config_path: /etc/alloy/config.alloy
    flags:
      storage.path: /var/lib/alloy/data
      server.http.listen-addr: 0.0.0.0:12345
      stability.level: experimental
  pprof:
    endpoint: 0.0.0.0:1777
  zpages:
    endpoint: 0.0.0.0:55679

receivers:
  otlp:
    protocols:
      grpc:
        endpoint: 0.0.0.0:4317  # Default OTLP/gRPC port

exporters:
  debug:
    verbosity: detailed
  otlp/tempo:
    # Use TEMPO_HOST if set, otherwise default to tempo:4317 (common in Docker Compose).
    # You can also point this to a remote Tempo gateway.
    endpoint: ${env:TEMPO_HOST:-tempo:4317}
    tls:
      insecure: true

processors:
  batch: {}

service:
  telemetry:
    logs:
      level: "debug"
      encoding: "console"
      development: true
    metrics:
      level: detailed
      readers:
        - pull:
            exporter:
              prometheus:
                host: 0.0.0.0
                port: 8888
  extensions: [alloyflow, pprof, zpages]
  pipelines:
    traces:
      receivers: [otlp]
      processors: [batch]
      exporters: [otlp/tempo, debug]
